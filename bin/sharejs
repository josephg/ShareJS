#!/usr/bin/env node

require('coffee-script');
var connect = require('connect'),
  sharejs = require('../src');

var server = connect(connect.logger());

options = require('./options') || {};

if(options.pem) {
    server = connect({
         key : fs.readFileSync(options.pem),
         cert : fs.readFileSync(options.pem)
     },connect.logger());
} else {
    server = connect(connect.logger());
}

if(options.log_level === 'verbose') {
	util.puts("ShareJS server v" + sharejs.version);
	util.puts("Options: ", options);
}

var port = options.port || 8000;

// Attach the sharejs REST and Socket.io interfaces to the server
sharejs.server.attach(server, options);

server.listen(port);

if(options.log_level === 'verbose') {
	util.puts("Server running on port: " + port);
}

process.title = 'sharejs'
process.on('uncaughtException', function (err) {
  util.puts('An error has occurred...');
  util.puts('Version ' + sharejs.version + ': ' + err.stack);
});