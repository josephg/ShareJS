#!/usr/bin/env node

require('coffee-script');
var connect = require('connect'),
  sharejs = require('../src');

var server = connect();

options = require('./options') || {};

if(options.log_level === 'verbose') {
	console.log("ShareJS server v" + sharejs.version);
	console.log("Options: ", options);
}

var port = options.port || 8000;

if(options.db.type === 'redis'){
  try{
    require('redis');
  }catch(e){}
}

// Attach the sharejs REST and Socket.io interfaces to the server
sharejs.server.attach(server, options);

server.listen(port);

if(options.log_level === 'verbose') {
	console.log("Server running on port: " + port);
}

process.title = 'sharejs'
process.on('uncaughtException', function (err) {
  console.error('An error has occurred...');
  console.error('Version ' + sharejs.version + ': ' + err.stack);
});