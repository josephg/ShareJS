(function(){var e,t,n,r,i,s,o,u=!0,a=window.sharejs,f={};f.name="text2",f.create=function(){return""},e=function(e){var t,n,r,i;if(!Array.isArray(e))throw new Error("Op must be an array of components");n=null;for(r=0,i=e.length;r<i;r++){t=e[r];switch(typeof t){case"object":if(!(typeof t.d=="number"&&t.d>0))throw new Error("Object components must be deletes of size > 0");break;case"string":if(!(t.length>0))throw new Error("Inserts cannot be empty");break;case"number":if(!(t>0))throw new Error("Skip components must be >0");if(typeof n=="number")throw new Error("Adjacent skip components should be combined")}n=t}if(typeof n=="number")throw new Error("Op has a trailing skip")},n=function(e){return function(t){if(!!t&&t.d!==0)return e.length===0?e.push(t):typeof t==typeof e[e.length-1]?typeof t=="object"?e[e.length-1].d+=t.d:e[e.length-1]+=t:e.push(t)}},r=function(e){var t=0,n=0,r=function(r,i){var s,o;return t===e.length?r===-1?null:r:(s=e[t],typeof s=="number"?r===-1||s-n<=r?(o=s-n,++t,n=0,o):(n+=r,r):typeof s=="string"?r===-1||i==="i"||s.length-n<=r?(o=s.slice(n),++t,n=0,o):(o=s.slice(n,n+r),n+=r,o):r===-1||i==="d"||s.d-n<=r?(o={d:s.d-n},++t,n=0,o):(n+=r,{d:r}))},i=function(){return e[t]};return[r,i]},t=function(e){return typeof e=="number"?e:e.length||e.d},s=function(e){return e.length>0&&typeof e[e.length-1]=="number"&&e.pop(),e},f.normalize=function(e){var t,r,i,o=[],u=n(o);for(r=0,i=e.length;r<i;r++)t=e[r],u(t);return s(o)},f.apply=function(t,n){var r,i,s,o,u;if(typeof t!="string")throw new Error("Snapshot should be a string");e(n),s=0,i=[];for(o=0,u=n.length;o<u;o++){r=n[o];switch(typeof r){case"number":if(r>t.length)throw new Error("The op is too long for this document");i.push(t.slice(0,r)),t=t.slice(r);break;case"string":i.push(r);break;case"object":t=t.slice(r.d)}}return i.join("")+t},f.transform=function(i,o,u){var a,f,l,c,h,p,d,v,m,g,y;if(u!=="left"&&u!=="right")throw new Error("side ("+u+") must be 'left' or 'right'");e(i),e(o),h=[],a=n(h),y=r(i),v=y[0],d=y[1];for(m=0,g=o.length;m<g;m++){l=o[m];switch(typeof l){case"number":c=l;while(c>0)f=v(c,"i"),a(f),typeof f!="string"&&(c-=t(f));break;case"string":u==="left"&&(p=d(),typeof p=="string"&&a(v(-1))),a(l.length);break;case"object":c=l.d;while(c>0){f=v(c,"i");switch(typeof f){case"number":c-=f;break;case"string":a(f);break;case"object":c-=f.d}}}}while(l=v(-1))a(l);return s(h)},f.compose=function(i,o){var u,a,f,l,c,h,p,d,v,m;e(i),e(o),c=[],u=n(c),m=r(i),h=m[0],p=m[1];for(d=0,v=o.length;d<v;d++){f=o[d];switch(typeof f){case"number":l=f;while(l>0)a=h(l,"d"),u(a),typeof a!="object"&&(l-=t(a));break;case"string":u(f);break;case"object":l=f.d;while(l>0){a=h(l,"d");switch(typeof a){case"number":u({d:a}),l-=a;break;case"string":l-=a.length;break;case"object":u(a)}}}}while(f=h(-1))u(f);return s(c)},i=function(e,t){var n,r,i,s=0;for(r=0,i=t.length;r<i;r++){n=t[r];if(e<=s)break;switch(typeof n){case"number":if(e<=s+n)return e;s+=n;break;case"string":s+=n.length,e+=n.length;break;case"object":e-=Math.min(n.d,e-s)}}return e},f.transformCursor=function(e,t,n){var r,s,o,u=0;if(n){for(s=0,o=t.length;s<o;s++){r=t[s];switch(typeof r){case"number":u+=r;break;case"string":u+=r.length}}return[u,u]}return[i(e[0],t),i(e[1],t)]},typeof u!="undefined"&&u!==null?a.types.text2=f:module.exports=f,typeof u!="undefined"&&u!==null?o=a.types.text2:o=require("./text2"),o.api={provides:{text:!0},getLength:function(){return this.snapshot.length},getText:function(){return this.snapshot},insert:function(e,t,n){var r=o.normalize([e,t]);return this.submitOp(r,n),r},del:function(e,t,n){var r=o.normalize([e,{d:t}]);return this.submitOp(r,n),r},_register:function(){return this.on("remoteop",function(e,t){var n,r,i,s,o=r=0,u=[];for(i=0,s=e.length;i<s;i++){n=e[i];switch(typeof n){case"number":o+=n,u.push(r+=n);break;case"string":this.emit("insert",o,n),u.push(o+=n.length);break;case"object":this.emit("delete",o,t.slice(r,r+n.d)),u.push(r+=n.d);break;default:u.push(void 0)}}return u})}}}).call(this)