(function(){var a=!0,b=window.sharejs,c=function(a,b){var c,d;if(b.id){if(typeof b.id!="string")throw new Error("invalid id "+b.id);if(!b.as&&!a.sessions[b.id])throw new Error("Referenced session ID missing");if(b.p&&(c=b.p)==="cursor")throw new Error("Cannot change property "+b.p);if(b.source&&b.source!==b.id)throw new Error("Not allowed to change another client's session data");if(b.as&&typeof b.as!="object")throw new Error("Session objects must be objects")}else{if(!(!b.p||(d=b.p)!=="sessions"&&d!=="ctime"&&d!=="mtime"))throw new Error("Cannot change property "+b.p);if(b.source)throw new Error("Only the server can change the root document metadata")}},d={name:"meta",create:function(a){var b=Date.now();return a||(a={}),a.sessions={},a.ctime=b,a.mtime=b,a},applyOp:function(a,b,c,d){var e,f,g,h,i;d==null&&(d="left");if((g=c.meta)!=null?g.ts:void 0)a.mtime=c.meta.ts,(h=a.ctime)==null&&(a.ctime=a.mtime);if(b.transformCursor){i=a.sessions;for(e in i)f=i[e],f.cursor!=null&&(f.cursor=b.transformCursor(f.cursor,c.op,d))}return a},transform:function(a,b,c,d){return b.c!=null&&a.transformCursor&&a.transformCursor(b.c,c,d),b},applyMop:function(a,b){return c(a,b),b.n?(a.sessions=b.n.sessions,a.ctime=b.n.ctime,a.mtime=b.n.mtime):b.as?a.sessions[b.id]=b.as:b.rs?delete a.sessions[b.id]:b.c!=null?a.sessions[b.id].cursor=b.c:b.p&&(b.id?b.v===void 0?delete a.sessions[b.id][b.p]:a.sessions[b.id][b.p]=b.v:b.v===void 0?delete a[b.p]:a[b.p]=b.v),a}};typeof a!="undefined"&&a!==null?b.meta=d:module.exports=d}).call(this)